<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Website Performance Tester</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 6px;
            border: 1px solid #e9ecef;
        }
        .url-input {
            width: 70%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            margin-right: 10px;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        .results {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin-top: 20px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .quick-tests {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        .quick-tests button {
            font-size: 14px;
            padding: 8px 12px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        .status.loading {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        .status.success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .status.error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        h1 {
            color: #333;
        }
        h2 {
            color: #666;
            margin-top: 0;
        }
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .metric-card {
            background: white;
            padding: 15px;
            border-radius: 4px;
            border: 1px solid #e9ecef;
            text-align: center;
        }
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
        }
        .metric-label {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
        .test-methods {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .method-card {
            background: white;
            padding: 15px;
            border-radius: 4px;
            border: 1px solid #e9ecef;
        }
        .method-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        .csp-info {
            background-color: #e7f3ff;
            border: 1px solid #b8daff;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .open-link {
            display: inline-block;
            margin-top: 10px;
            color: #007bff;
            text-decoration: none;
            font-weight: bold;
        }
        .open-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Website Performance Tester</h1>
        
        <div class="csp-info">
            <strong>‚ÑπÔ∏è CSP Protection Notice:</strong> Many websites block iframe embedding for security. This tool uses multiple methods to test performance while respecting these protections.
        </div>
        
        <div class="test-section">
            <h2>Test Website Performance</h2>
            <input type="url" id="websiteUrl" class="url-input" placeholder="Enter website URL (e.g., https://google.com)" value="https://httpbin.org/delay/1">
            <button onclick="testWebsite()">Test Website</button>
            <button onclick="openInNewTab()">Open in New Tab</button>
            
            <div class="quick-tests">
                <button onclick="testQuickSite('https://httpbin.org/delay/1')">Test HTTPBin (1s delay)</button>
                <button onclick="testQuickSite('https://httpbin.org/delay/2')">Test HTTPBin (2s delay)</button>
                <button onclick="testQuickSite('https://jsonplaceholder.typicode.com/posts')">Test JSONPlaceholder</button>
                <button onclick="testQuickSite('https://api.github.com/users/octocat')">Test GitHub API</button>
                <button onclick="testQuickSite('https://reqres.in/api/users/1')">Test ReqRes API</button>
                <button onclick="testQuickSite('https://dummyjson.com/products/1')">Test DummyJSON</button>
            </div>
            
            <div id="status"></div>
            
            <div class="metrics" id="metrics" style="display: none;">
                <div class="metric-card">
                    <div class="metric-value" id="fetchTime">-</div>
                    <div class="metric-label">Fetch Time (ms)</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="responseSize">-</div>
                    <div class="metric-label">Response Size (bytes)</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="statusCode">-</div>
                    <div class="metric-label">Status Code</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="serverTime">-</div>
                    <div class="metric-label">Server Header Time</div>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>Alternative Testing Methods</h2>
            <div class="test-methods">
                <div class="method-card">
                    <div class="method-title">üîó Direct Navigation Test</div>
                    <p>Opens the website in a new tab where you can see real loading performance using browser dev tools (F12).</p>
                    <button onclick="openInNewTab()">Open & Test</button>
                </div>
                <div class="method-card">
                    <div class="method-title">üì° Network Request Test</div>
                    <p>Measures server response time and download speed using fetch API.</p>
                    <button onclick="testNetworkOnly()">Test Network</button>
                </div>
                <div class="method-card">
                    <div class="method-title">üñºÔ∏è Resource Loading Test</div>
                    <p>Tests loading of images, scripts, and other resources from the website.</p>
                    <button onclick="testResourceLoading()">Test Resources</button>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>Manual Testing Instructions</h2>
            <p><strong>For accurate website performance testing:</strong></p>
            <ol>
                <li>Click "Open in New Tab" to open the website</li>
                <li>Press <strong>F12</strong> to open Developer Tools</li>
                <li>Go to the <strong>Network</strong> tab</li>
                <li>Refresh the page (<strong>Ctrl+R</strong> or <strong>Cmd+R</strong>)</li>
                <li>Check the load time at the bottom of the Network tab</li>
                <li>Go to <strong>Lighthouse</strong> tab for detailed performance analysis</li>
            </ol>
        </div>
        
        <div class="test-section">
            <h2>Performance Results</h2>
            <button onclick="clearResults()">Clear Results</button>
            <div id="results" class="results">Performance measurements will appear here...</div>
        </div>
    </div>

    <script>
        // Set up Performance Observer
        const observer = new PerformanceObserver((list) => {
            const resultsDiv = document.getElementById('results');
            
            for (const entry of list.getEntries()) {
                const timestamp = new Date().toLocaleTimeString();
                const result = `[${timestamp}] ${entry.name}: ${entry.duration.toFixed(2)}ms\n`;
                resultsDiv.textContent += result;
                resultsDiv.scrollTop = resultsDiv.scrollHeight;
            }
        });
        
        observer.observe({entryTypes: ['measure']});
        
        function showStatus(message, type = 'loading') {
            const statusDiv = document.getElementById('status');
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
            statusDiv.style.display = 'block';
        }
        
        function hideStatus() {
            const statusDiv = document.getElementById('status');
            statusDiv.style.display = 'none';
        }
        
        function updateMetrics(metrics) {
            const metricsDiv = document.getElementById('metrics');
            metricsDiv.style.display = 'grid';
            
            document.getElementById('fetchTime').textContent = metrics.fetchTime || '-';
            document.getElementById('responseSize').textContent = metrics.responseSize || '-';
            document.getElementById('statusCode').textContent = metrics.statusCode || '-';
            document.getElementById('serverTime').textContent = metrics.serverTime || '-';
        }
        
        function testQuickSite(url) {
            document.getElementById('websiteUrl').value = url;
            testWebsite();
        }
        
        function openInNewTab() {
            const url = document.getElementById('websiteUrl').value;
            if (!url) {
                showStatus('Please enter a website URL', 'error');
                return;
            }
            
            let testUrl = url;
            if (!testUrl.startsWith('http://') && !testUrl.startsWith('https://')) {
                testUrl = 'https://' + testUrl;
            }
            
            showStatus(`Opening ${testUrl} in new tab for manual testing...`, 'success');
            window.open(testUrl, '_blank');
        }
        
        async function testWebsite() {
            const url = document.getElementById('websiteUrl').value;
            
            if (!url) {
                showStatus('Please enter a website URL', 'error');
                return;
            }
            
            let testUrl = url;
            if (!testUrl.startsWith('http://') && !testUrl.startsWith('https://')) {
                testUrl = 'https://' + testUrl;
            }
            
            showStatus(`Testing ${testUrl}...`, 'loading');
            
            await testNetworkPerformance(testUrl);
        }
        
        async function testNetworkOnly() {
            const url = document.getElementById('websiteUrl').value;
            if (!url) {
                showStatus('Please enter a website URL', 'error');
                return;
            }
            
            let testUrl = url;
            if (!testUrl.startsWith('http://') && !testUrl.startsWith('https://')) {
                testUrl = 'https://' + testUrl;
            }
            
            await testNetworkPerformance(testUrl);
        }
        
        async function testNetworkPerformance(testUrl) {
            const domain = getDomain(testUrl);
            
            // Test 1: Basic fetch performance
            performance.mark('start-fetch');
            
            try {
                const response = await fetch(testUrl, {
                    method: 'GET',
                    cache: 'no-cache'
                });
                
                performance.mark('end-fetch');
                performance.measure(`Network-Fetch-${domain}`, 'start-fetch', 'end-fetch');
                
                const responseText = await response.text();
                const responseSize = new Blob([responseText]).size;
                
                const metrics = {
                    fetchTime: Math.round(performance.getEntriesByName(`Network-Fetch-${domain}`)[0].duration),
                    responseSize: responseSize,
                    statusCode: response.status,
                    serverTime: response.headers.get('server-timing') || 'N/A'
                };
                
                updateMetrics(metrics);
                showStatus(`‚úÖ Successfully tested ${domain}`, 'success');
                
            } catch (error) {
                performance.mark('end-fetch');
                performance.measure(`Network-Fetch-FAILED-${domain}`, 'start-fetch', 'end-fetch');
                
                showStatus(`‚ùå Failed to test ${testUrl}: ${error.message}`, 'error');
                updateMetrics({
                    fetchTime: '-',
                    responseSize: 'Error',
                    statusCode: 'Error',
                    serverTime: 'Error'
                });
            }
            
            // Test 2: Multiple requests to measure consistency
            await testMultipleRequests(testUrl, domain);
        }
        
        async function testMultipleRequests(testUrl, domain) {
            const requestCount = 3;
            const times = [];
            
            for (let i = 0; i < requestCount; i++) {
                performance.mark(`start-multi-${i}`);
                
                try {
                    const response = await fetch(testUrl, {
                        method: 'HEAD',
                        cache: 'no-cache'
                    });
                    
                    performance.mark(`end-multi-${i}`);
                    performance.measure(`Multi-Request-${i}-${domain}`, `start-multi-${i}`, `end-multi-${i}`);
                    
                    const duration = performance.getEntriesByName(`Multi-Request-${i}-${domain}`)[0].duration;
                    times.push(duration);
                    
                } catch (error) {
                    performance.mark(`end-multi-${i}`);
                    performance.measure(`Multi-Request-${i}-FAILED-${domain}`, `start-multi-${i}`, `end-multi-${i}`);
                }
            }
            
            if (times.length > 0) {
                const avgTime = times.reduce((a, b) => a + b, 0) / times.length;
                performance.mark('avg-start');
                performance.mark('avg-end');
                performance.measure(`Average-Response-${domain}`, 'avg-start', 'avg-end');
                
                // Manually set the duration for the average measure
                const entries = performance.getEntriesByName(`Average-Response-${domain}`);
                if (entries.length > 0) {
                    // This is a workaround since we can't directly set the duration
                    const resultsDiv = document.getElementById('results');
                    const timestamp = new Date().toLocaleTimeString();
                    const result = `[${timestamp}] Average-Response-${domain}: ${avgTime.toFixed(2)}ms (${times.length} requests)\n`;
                    resultsDiv.textContent += result;
                    resultsDiv.scrollTop = resultsDiv.scrollHeight;
                }
            }
        }
        
        async function testResourceLoading() {
            const url = document.getElementById('websiteUrl').value;
            if (!url) {
                showStatus('Please enter a website URL', 'error');
                return;
            }
            
            showStatus('Testing resource loading...', 'loading');
            
            // Test loading an image from the domain
            const domain = getDomain(url);
            const imgUrl = `${url}/favicon.ico`;
            
            performance.mark('start-resource');
            
            const img = new Image();
            img.onload = function() {
                performance.mark('end-resource');
                performance.measure(`Resource-Load-${domain}`, 'start-resource', 'end-resource');
                showStatus(`‚úÖ Successfully loaded resource from ${domain}`, 'success');
            };
            
            img.onerror = function() {
                performance.mark('end-resource');
                performance.measure(`Resource-Load-FAILED-${domain}`, 'start-resource', 'end-resource');
                showStatus(`‚ùå Failed to load resource from ${domain}`, 'error');
            };
            
            img.src = imgUrl;
        }
        
        function getDomain(url) {
            try {
                return new URL(url).hostname;
            } catch (e) {
                return 'unknown';
            }
        }
        
        function clearResults() {
            document.getElementById('results').textContent = 'Performance measurements will appear here...';
            document.getElementById('metrics').style.display = 'none';
            hideStatus();
        }
        
        // Initial setup
        hideStatus();
        
        // Add some initial helpful text
        document.getElementById('results').textContent = 
            'Performance measurements will appear here...\n\n' +
            'TIP: Use the "Open in New Tab" button and browser dev tools (F12) for detailed website performance analysis.\n\n' +
            'The quick test buttons use APIs that allow cross-origin requests for demonstration.';
    </script>
</body>
</html>
